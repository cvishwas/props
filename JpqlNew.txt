// src/main/java/com/example/repository/UserRoleRepository.java
package com.example.repository;

import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.CrudRepository;
import org.springframework.data.repository.query.Param;

import com.example.model.User;

import java.util.List;

public interface UserRoleRepository extends CrudRepository<User, Long> {

    // Fetch users with their active roles; users with no active roles will have null/empty roles
    @Query("""
        SELECT DISTINCT u.id AS userId, u.username AS username,
                        r.id AS roleId, r.name AS roleName
        FROM User u
        LEFT JOIN u.userRoles ur ON ur.user.id = u.id
        LEFT JOIN ur.role r ON ur.role.id = r.id
        WHERE ur.activeFlag = 'Y' OR ur.activeFlag IS NULL
        """)
    List<Object[]> findUsersWithActiveOrNullableRoles();
}